<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Halacha/Hashkafah</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#0b63ce;
      --accent2:#0752ad;
      --chip:#eef2ff;
      --shadow: 0 10px 25px rgba(0,0,0,.06);
      --radius: 16px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header{
      padding: 28px 18px 10px;
      text-align:center;
    }
    header h1{
      margin:0;
      font-size: 2rem;
      letter-spacing: .2px;
      color: var(--accent2);
    }
    header p{
      margin: 10px auto 0;
      max-width: 880px;
      color: var(--muted);
      line-height: 1.45;
    }

    .container{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px;
    }

    .topbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      margin: 12px 0 22px;
    }

    .search{
      flex: 1 1 420px;
      max-width: 560px;
      position: relative;
    }
    .search input{
      width:100%;
      padding: 12px 14px;
      border:1px solid var(--line);
      border-radius: 999px;
      outline:none;
      font-size: 15px;
      background: #fff;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }

    .chip{
      background: var(--chip);
      color: var(--accent2);
      border: 1px solid #dbe3ff;
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 13px;
      white-space: nowrap;
    }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      margin-bottom: 14px;
    }

    details.category{
      padding: 0;
    }

    details.category > summary{
      list-style:none;
      padding: 16px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      user-select:none;
      cursor: default; /* not clicky */
    }

    details.category > summary::-webkit-details-marker{display:none}

    .cat-title{
      display:flex;
      align-items:center;
      gap:10px;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent2);
    }

    .count{
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--line);
      background: #fafafa;
      padding: 4px 10px;
      border-radius: 999px;
    }

    .content{
      border-top: 1px solid var(--line);
      padding: 14px 16px 16px;
    }

.helper-text{
  margin-top: 8px;
  font-size: 13px;
  color: var(--muted);
  text-align: center;
}

    
    .subgrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
    }

    details.subcat{
      background: #fbfcff;
      border:1px solid var(--line);
      border-radius: 14px;
      overflow:hidden;
    }
    details.subcat > summary{
      list-style:none;
      padding: 12px 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      user-select:none;
      font-weight: 650;
      color:#0f3f7a;
      cursor: default; /* not clicky */
    }
    details.subcat > summary::-webkit-details-marker{display:none}

    .items{
      border-top: 1px solid var(--line);
      padding: 10px 12px 12px;
    }

    .item{
      border:1px solid var(--line);
      background:#fff;
      border-radius: 12px;
      padding: 10px 10px;
      margin: 8px 0;
    }

    .item-meta{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items: baseline;
      flex-wrap:wrap;
      margin-bottom: 6px;
    }

    .item-title{
      font-weight: 700;
      font-size: 14px;
    }
    .item-note{
      color: var(--muted);
      font-size: 12px;
    }

.tm-note-row{
  display:flex;
  align-items:center;
  gap:10px;
  border:1px dashed var(--line);
  background:#f8fafc;
  border-radius: 14px;
  padding: 12px 14px;
  font-size: 13px;
  cursor: pointer;
}

.tm-note-row .icon{
  font-size: 18px;
}

.tm-note-row a{
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
}

.tm-note-row a:hover{
  text-decoration: underline;
}

    .tm-note-row:hover{
  background: #eef2ff;
}

.tm-link-row .tm-play{
  color: #dc2626; /* subtle red hint = YouTube */
}

    .tm-row.tm-youtube{
  border-style: dashed;
  background: #fcfcff;
}

.tm-speed{
  border: 1px solid var(--line);
  background: #f9fafb;
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 12px;
  font-weight: 600;
  color: #374151;
  cursor: pointer;
  user-select: none;
}


    
    audio{
      width:100%;
      margin-top: 6px;
    }

    .link{
      display:inline-block;
      margin-top: 6px;
      font-size: 13px;
      color: var(--accent);
      text-decoration: none;
    }
    .link:hover{ text-decoration: underline; }

    .empty{
      color: var(--muted);
      font-size: 13px;
      padding: 8px 0 0;
    }

    /* Responsive YouTube embed */
    .video-wrap{
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 */
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--line);
      background: #000;
      margin-top: 8px;
    }
    .video-wrap iframe{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
    }

    footer{
      text-align:center;
      color: var(--muted);
      padding: 18px;
      font-size: 12px;
    }

.tm-badge{
  font-size: 12px;
  padding: 5px 10px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: #f8fafc;
  color: #374151;
  white-space: nowrap;
}

    
/* --- TorahMoment-style custom audio player --- */
.tm-player{
  display:flex;
  align-items:center;
  gap:10px;
  border:1px solid var(--line);
  background:#f9fafb;
  border-radius: 14px;
  padding: 10px 12px;
}

.tm-btn{
  width:42px;
  height:42px;
  border-radius:999px;
  border:1px solid var(--line);
  background:#fff;
  cursor:pointer;
  font-weight:800;
  color: var(--accent2);
}

.tm-seek{
  flex:1;
  height: 4px;
}

.tm-time{
  min-width: 96px;
  text-align:right;
  font-size: 12px;
  color: var(--muted);
  font-variant-numeric: tabular-nums;
}

.tm-meta{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items: baseline;
  flex-wrap:wrap;
  margin-bottom: 8px;
}

.tm-title{
  font-weight: 650;
  font-size: 14px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
   cursor: default;
}
.tm-title::after{
  content: attr(title);
  display: none;
}

/* Mobile title expand */
.tm-title{
  cursor: pointer;
}

.tm-title.expanded{
  white-space: normal;
  overflow: visible;
  text-overflow: unset;
}

/* Only allow tap-to-expand on small screens */
@media (min-width: 768px){
  .tm-title{
    cursor: default;
  }
}

@media (max-width: 767px){
  header p{
    display: none;
  }
}

.tm-note{
  color: var(--muted);
  font-size: 12px;
}

.tm-title-row{
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 12px;
  margin-bottom: 6px;
}

.tm-title-row .tm-title{
  font-weight: 650;
  font-size: 14px;
  flex: 1 1 auto;
}

.tm-title-row .tm-note{
  font-size: 12px;
  color: var(--muted);
  white-space: nowrap;
  flex: 0 0 auto;
}

    
/* --- Playlist-row player (matches your screenshot style) --- */
.item{
  padding: 0;
  border: 0;
  background: transparent;
  margin: 10px 0;
}

.tm-row{
  display:flex;
  align-items:center;
  gap: 12px;
  border: 1px solid var(--line);
  background: #fff;
  border-radius: 14px;
  padding: 12px 14px;
}

.tm-row{
  cursor: pointer;
}
.tm-row:hover{
  box-shadow: 0 6px 16px rgba(0,0,0,.05);
}

    
.tm-play{
  width: 42px;
  height: 42px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: #fff;
  cursor: pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 900;
  color: var(--accent2);
  flex: 0 0 auto;
}

.tm-main{
  flex: 1 1 auto;
  min-width: 0;
}

.tm-title{
  font-weight: 650;
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.tm-right{
  display:flex;
  align-items:center;
  gap: 10px;
  flex: 0 0 auto;
}

.tm-dur{
  color: var(--muted);
  font-size: 12px;
  font-variant-numeric: tabular-nums;
}


/* Optional: thin progress line like a modern playlist */
.tm-progress{
  height: 3px;
  background: #eef2f7;
  border-radius: 999px;
  margin-top: 8px;
  overflow:hidden;
}
.tm-progress > div{
  height: 100%;
  width: 0%;
  background: var(--accent);
  border-radius: 999px;
}


    
  </style>
  
</head>

<body>
  <header>
    <h1>Halacha/Hashkafah</h1>
    <div id="helperText" class="helper-text">
 Please note that nothing on this page should be taken as psak din and all questions should be addressed to a trusted Rabbi.
</div>
  </header>

  <div class="container">
    <div class="topbar">
      <div class="search">
        <input id="searchInput" type="text" placeholder="Search (e.g., Shema, Purim, Tzedakah)..." />
      </div>
      <div class="chip" id="resultChip">Showing all</div>
    </div>

    <!-- ===================== -->
    <!-- DATA (Edit here only) -->
    <!-- ===================== -->
    <script>
      // HOW TO ADD ITEMS:
      // Add objects inside any "items: []" list.
      //
      // AUDIO (inline player):
      // { type:"audio", title:"Title", url:"https://...mp3", note:"Optional" }
      //
      // YOUTUBE (embedded):
      // { type:"youtube", title:"Title", url:"https://www.youtube.com/watch?v=VIDEOID", note:"Optional" }

      const PAGE_DATA = [
        {
          category: "Tefilah",
          subcategories: [
            {
              name: 'Talis/Tefilin',items: [
                {type: "audio",title: "Double Black Tefilin", url: "https://www.buzzsprout.com/1899789/episodes/18540770-1-20-2025-shloimy-zelcer-double-black-tefilin.mp3", note: "1/20/2026"},
                {type: "audio",title: "Stripes on the Talis", url: "https://www.buzzsprout.com/1899789/episodes/16448331-1-16-2025-shloimy-zelcer-stripes-on-the-talis.mp3", note: "1/16/2025"}
              ]  },
            { name: 'Shema', items: [
              {type: "audio",title: "Standing up to say Krias Shema", url: "https://www.buzzsprout.com/1899789/episodes/17508580-7-15-2025-shloimy-zelcer-standing-up-to-say-kriyas-shema.mp3", note: "7/15/2025"}
            ] },
            { name: 'Shmoneh Esrei/Chazaras Hashat"z', items: [
              {type: "audio",title: "Do you have to know what youre saying in davening?", url: "https://www.buzzsprout.com/1899789/episodes/17665749-8-13-2025-shloimy-zelcer-do-you-have-to-know-what-youre-saying-in-davening.mp3", note: "8/13/2025"},
              {type: "audio",title: "Answering Baruch Hu Uvaruch Shemo", url: "https://www.buzzsprout.com/1899789/episodes/17240722-5-28-2025-shloimy-zelcer-answering-baruch-hu-uvaruch-shemo.mp3", note: "5/28/2025"},
              {type: "audio",title: "Answering Amen to ◊í÷º÷∏◊ê÷∑◊ú ◊ô÷¥◊©◊Ç÷∞◊®÷∏◊ê÷µ◊ú", url: "https://www.buzzsprout.com/1899789/episodes/16829518-3-26-2025-shloimy-zelcer-answering-amen-to.mp3", note: "3/26/2025"},
              {type: "note", text: "For an explanation of each bracha of Shemoneh Esrei, see this playlist.", linkText: "View playlist", url: "https://parsha.torahmoment.com/tefilah.html"}
            ] },
            { name: 'Krias Hatorah', items: [
              {type: "audio",title: "Asking a kohen to leave", url: "https://www.buzzsprout.com/1899789/episodes/16170138-11-25-2024-shloimy-zelcer-asking-a-kohen-to-leave.mp3", note: "11/25/2024"},
              {type: "audio",title: "Who gets the first aliyah when there is no kohen", url: "https://www.buzzsprout.com/1899789/episodes/16134190-11-19-2024-shloimy-zelcer-who-gets-the-first-aliyah-when-there-is-no-kohen.mp3", note: "11/19/2024"}
            ] },
            { name: 'Kadish', items: [
              {type: "audio",title: "Women saying Kadish", url: "https://www.buzzsprout.com/1899789/episodes/17345373-6-16-2025-shloimy-zelcer-women-saying-kadish.mp3", note: "6/16/2025"}
            ] },
            { name: 'Other Tefilos', items: [
               {type: "audio",title: "Daven to Hashem, not angels", url: "https://www.buzzsprout.com/1899789/episodes/18285871-12-3-2025-shloimy-zelcer-daven-to-hashem-not-angels.mp3", note: "12/3/2025"},
               {type: "audio",title: "Tefilas Haderech", url: "https://www.buzzsprout.com/1899789/episodes/17012786-4-21-2025-shloimy-zelcer-tefilas-haderech.mp3", note: "4/21/2025"},
               {type: "audio",title: "◊ì÷º÷∏◊ï÷¥◊ì ◊û÷∂◊ú÷∂◊ö÷∞ ◊ô÷¥◊©◊Ç÷∞◊®÷∏◊ê÷µ◊ú ◊ó÷∑◊ô ◊ï÷∞◊ß÷∑◊ô÷º÷∏◊ù ◊ë◊ß◊ô◊ì◊ï◊© ◊ú◊ë◊†◊î", url: "https://www.buzzsprout.com/1899789/episodes/16554683-2-3-2025-shloimy-zelcer.mp3", note: "2/3/2025"}
            ] },
            { name: 'Misc.', items: [
               {type: "audio",title: "When Davening takes too long", url: "https://www.buzzsprout.com/1899789/episodes/18082159-10-28-2025-shloimy-zelcer-when-davening-takes-too-long.mp3", note: "10/28/2025"},
               {type: "audio",title: "Kiddush in middle of davening?", url: "https://www.buzzsprout.com/1899789/episodes/17430394-7-1-2025-shloimy-zelcer-kiddush-in-middle-of-davening.mp3", note: "7/1/2025"},
              {type: "audio",title: "Head covering during prayer", url: "https://www.buzzsprout.com/1899789/episodes/10438736-4-12-2022-shloimy-zelcer.mp3?download=true", note: "4/12/2022"}
            ] }
          ]
        },

        {
          category: "Yom Tov",
          subcategories: [
            { name: 'Elul', items: [
              {type: "audio",title: "Teshuva - returning home", url: "https://www.buzzsprout.com/1899789/episodes/15721287-9-9-2024-shloimy-zelcer-teshuva-returning-home.mp3", note: "9/9/2024"},
              {type: "audio",title: "Teshuva like snow and laundry", url: "https://www.buzzsprout.com/1899789/episodes/14272565-1-8-2024-shloimy-zelcer.mp3", note: "1/8/2024"}
            ] },
            { name: 'Sukkos', items: [
              {type: "audio",title: "The importance of the Aravos", url: "https://www.buzzsprout.com/1899789/episodes/15931239-10-15-2024-shloimy-zelcer-the-importance-of-the-aravos.mp3", note: "10/15/2024"},
              { type:"youtube", title:"Sukkah heals our wounds", url:"https://youtu.be/qI8KKe3om1c", note:"9/28/2023" }
            ] },
            { name: 'Chanukah', items: [
              {type: "audio",title: "8 lesser known answers to the famous question of the Beis Yosef", url: "https://www.buzzsprout.com/1899789/episodes/11906323-12-20-2022-shloimy-zelcer.mp3", note: "12/20/2022"},
              { type:"youtube", title:"Chanukah thought", url:"https://youtu.be/gzQiPo2JKT8", note:"Optional" },
              { type:"youtube", title:"A little at a time", url:"https://youtu.be/ScsMi-d0qHs", note:"Optional" }
            ] },
            { name: 'Purim', items: [
              {type: "audio",title: "Three lesser discussed halachos regarding Purim", url: "https://www.buzzsprout.com/1899789/episodes/10184217-3-3-2022-shloimy-zelcer.mp3", note: "3/3/2022"},
              { type:"youtube", title:"Purim thoughts", url:"https://youtu.be/4ZhRg40--g8", note:"Optional" }
            ] },
            { name: 'Lag Baomer', items: [
              {type: "audio",title: "A Lesson from Lag Baomer", url: "https://www.buzzsprout.com/1899789/episodes/15124705-5-23-2024-shloimy-zelcer-a-lesson-from-lag-baomer.mp3", note: "5/23/2024"}
            ] },
            { name: 'Pesach', items: [
              { type:"youtube", title:"The perfect child", url:"https://youtu.be/hLOR9lvtuUE", note:"Optional" }
            ] },
          ]
        },

        { category: "Israel", items: [
          {type: "audio",title: "The Israeli flag in halacha", url: "https://www.buzzsprout.com/1899789/episodes/12730340-4-26-2023-shloimy-zelcer.mp3", note: "4/26/2023"},
          {type: "audio",title: "Tearing Kriyah at the Kotel", url: "https://www.buzzsprout.com/1899789/episodes/11305071-9-12-2022-shloimy-zelcer.mp3", note: "9/12/2022"},
          {type: "audio",title: "Religious Zionism", url: "https://2mishnasaday.com/wp-content/uploads/religiouszionism.mp3", note: "7/31/2019"}
        ] },
        { category: "Tzedakah", items: [
          {type: "audio",title: "Unverified collectors", url: "https://www.buzzsprout.com/1899789/episodes/16732918-3-4-2025-shloimy-zelcer-giving-tzedakah-part-2-unverified-collectors.mp3", note: "3/4/2025"},        
          {type: "audio",title: "The obligation to give", url: "https://www.buzzsprout.com/1899789/episodes/16697000-2-26-2025-shloimy-zelcer-giving-tzedakah-part-1-the-obligation-to-give.mp3", note: "2/26/2025"},
          {type: "audio",title: "Machatzis Hashekel in halacha", url: "https://www.buzzsprout.com/1899789/episodes/14624968-2-29-2024-shloimy-zelcer.mp3", note: "2/29/2024"}
        ] },
        { category: "Talmud Torah", items: [
          {type: "audio",title: "Various aspects of talmud torah", url: "https://www.buzzsprout.com/1899789/episodes/15494012-7-30-2024-shloimy-zelcer-various-aspects-of-talmud-torah.mp3", note: "7/30/2024"},
          {type: "audio",title: "◊ê◊ú◊ï ◊ï◊ê◊ú◊ï ◊ì◊ë◊®◊ô ◊ê◊ú◊ß◊ô◊ù ◊ó◊ô◊ô◊ù", url: "https://www.buzzsprout.com/1899789/episodes/15026066-5-7-2024-shloimy-zelcer.mp3", note: "5/7/2024"},
          {type: "audio",title: "Learning the written and oral Torah", url: "https://www.buzzsprout.com/1899789/episodes/14864486-4-10-2024-shloimy-zelcer-learning-the-written-and-oral-torah.mp3", note: "4/10/2024"},
          {type: "audio",title: "Defining Torah Shebaal Peh", url: "https://www.buzzsprout.com/1899789/episodes/14763027-3-25-2024-shloimy-zelcer-defining-torah-shebaal-peh.mp3", note: "3/25/2024"},
          {type: "audio",title: "Making a Siyum", url: "https://www.buzzsprout.com/1899789/episodes/14362862-1-23-2024-shloimy-zelcer.mp3", note: "1/23/2024"},
          {type: "audio",title: "The 6 stages of Torah-toil", url: "https://www.buzzsprout.com/1899789/episodes/10675134-5-24-2022-shloimy-zelcer.mp3", note: "5/24/2022"},
          {type: "audio",title: "Reconnecting our inner flame.  A Jew's internal connection to Talmud Torah", url: "https://www.buzzsprout.com/1899789/episodes/9861401-1-10-2022-shloimy-zelcer.mp3", note: "1/10/2022"}
        ] },
        { category: "MISC.", items: [
          {type: "audio",title: "3 lessons Lzehcer Harav Avrohom Nesanel ben Shlomo on his first Yahrtzeit", url: "https://www.buzzsprout.com/1899789/episodes/17866609-9-18-2025-shloimy-zelcer-3-lessons-lzehcer-nishmas-moireinu-harav-avrohom-nesanel-ben-shlomo-on-his-first-yahrtzeit.mp3", note: "9/18/2025"},
          {type: "audio",title: "Third time's the charm in Jewish history", url: "https://www.buzzsprout.com/1899789/episodes/15612428-8-20-2024-shloimy-zelcer-third-time-s-the-charm-in-jewish-history.mp3", note: "8/20/2024"},
          {type: "audio",title: "The avos as a blueprint for Jewish history", url: "https://www.buzzsprout.com/1899789/episodes/15606341-8-19-2024-shloimy-zelcer-the-avos-as-a-blueprint-for-jewish-history.mp3", note: "8/19/2024"},
          {type: "audio",title: "Should the death of an evil person be celebrated?", url: "https://www.buzzsprout.com/1899789/episodes/15508964-7-31-2024-shloimy-zelcer-should-the-death-of-an-evil-person-be-celebrated.mp3", note: "7/31/2024"},
          {type: "audio",title: "◊©◊ï◊ô◊™◊ô ◊î◊≥ ◊ú◊†◊í◊ì◊ô ◊™◊û◊ô◊ì", url: "https://www.buzzsprout.com/1899789/episodes/15302666-6-24-2024-shloimy-zelcer.mp3", note: "6/24/2024"},
          {type: "audio",title: "The Torah's perspective on earthquakes", url: "https://www.buzzsprout.com/1899789/episodes/14834618-4-5-2024-shloimy-zelcer-the-torah-s-perspective-on-earthquakes.mp3", note: "4/5/2024"},
          {type: "audio",title: "Asking two Rabbis the same Halachic question", url: "https://www.buzzsprout.com/1899789/episodes/11783471-11-29-2022-shloimy-zelcer.mp3", note: "11/29/2022"},
          {type: "audio",title: "A misconception regarding tevilas keilim", url: "https://www.buzzsprout.com/1899789/episodes/11006941-7-21-2022-shloimy-zelcer.mp3", note: "7/21/2022"}
        ] },
      ];
    </script>

    <!-- ===================== -->
    <!-- RENDER TARGET         -->
    <!-- ===================== -->
    <div id="app"></div>

    <footer>
      torahmoment.com ‚Ä¢ Halacha/Hashkafah
    </footer>
  </div>

  <script>
    const app = document.getElementById("app");
    const searchInput = document.getElementById("searchInput");
    const resultChip = document.getElementById("resultChip");

    function escapeHtml(str){
      return (str ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

function enableMobileTitleExpand(){
  document.querySelectorAll(".tm-title").forEach(el => {
    el.addEventListener("click", (e) => {
      // Only toggle on mobile-sized screens
      if (window.innerWidth >= 768) return;
      e.stopPropagation(); // don't trigger play/pause
      el.classList.toggle("expanded");
    });
  });
}

    
    function getYouTubeId(url){
      if(!url) return "";
      try{
        const u = new URL(url);
        if (u.hostname.includes("youtu.be")) return u.pathname.replace("/", "");
        if (u.searchParams.get("v")) return u.searchParams.get("v");
        const parts = u.pathname.split("/").filter(Boolean);
        const embedIndex = parts.indexOf("embed");
        if (embedIndex >= 0 && parts[embedIndex+1]) return parts[embedIndex+1];
        const shortsIndex = parts.indexOf("shorts");
        if (shortsIndex >= 0 && parts[shortsIndex+1]) return parts[shortsIndex+1];
        return parts[parts.length - 1] || "";
      } catch {
        return "";
      }
    }

    function itemMatches(item, q){
      const blob = `${item.title || ""} ${item.note || ""}`.toLowerCase();
      return blob.includes(q);
    }

    function countItemsInCategory(cat){
      if (Array.isArray(cat.subcategories)) {
        return cat.subcategories.reduce((sum, s) => sum + (s.items?.length || 0), 0);
      }
      return cat.items?.length || 0;
    }

    function renderItem(item){
      const title = escapeHtml(item.title || "Item");
      const note = escapeHtml(item.note || "");
      const url = item.url || "";
      const type = (item.type || "audio").toLowerCase();

// NOTE / LINK ITEM (entire row clickable)
if (type === "note") {
  return `
    <div class="item">
      <div class="tm-note-row" data-url="${escapeHtml(item.url)}">
        <div class="icon">‚ÑπÔ∏è</div>
        <div>
          ${escapeHtml(item.text)}
          <span style="margin-left:6px; font-weight:600; color:var(--accent);">
            ${escapeHtml(item.linkText || "Learn more")} ‚Üí
          </span>
        </div>
      </div>
    </div>
  `;
}

      
      // AUDIO
 if (type === "audio") {
  const pid = "tm_" + Math.random().toString(36).slice(2);

  return `
    <div class="item" data-search="${escapeHtml((item.title||"") + " " + (item.note||""))}">
      
      <!-- Topic / title ABOVE player -->
   <div class="tm-title-row">
  <div class="tm-title" title="${title}">${title}</div>

  ${item.note ? `<div class="tm-note">${escapeHtml(item.note)}</div>` : ``}
</div>

      <div class="tm-row" data-audio-id="${pid}">
        <button class="tm-play" type="button" aria-label="Play/Pause">‚ñ∂</button>

        <div class="tm-main">
          <div class="tm-progress"><div></div></div>
        </div>

        <div class="tm-right">
        <div class="tm-speed">1√ó</div>
          <div class="tm-dur">(0:00)</div>
        </div>

        <audio id="${pid}" preload="metadata" src="${escapeHtml(url)}"></audio>
      </div>
    </div>
  `;
}



     // YOUTUBE ‚Äì playlist row style (uniform with audio)
if (type === "youtube") {
  return `
    <div class="item">

      <!-- Title + note ABOVE (same as audio) -->
      <div class="tm-title-row">
        <div class="tm-title">${title}</div>
        ${item.note ? `<div class="tm-note">${escapeHtml(item.note)}</div>` : ``}
      </div>

      <div class="tm-row tm-link-row tm-youtube" data-url="${escapeHtml(item.url)}">
        <button class="tm-play">üé•</button>

        <div class="tm-main">
          <!-- empty on purpose for uniform spacing -->
        </div>

        <div class="tm-right">
          <div class="tm-badge">üé• YouTube</div>
        </div>
      </div>
    </div>
  `;
}



      function openMatchingSections(){
  document.querySelectorAll(".item").forEach(item => {
    const detailsSub = item.closest("details.subcat");
    const detailsCat = item.closest("details.category");

    if (detailsSub) detailsSub.setAttribute("open", "");
    if (detailsCat) detailsCat.setAttribute("open", "");
  });
}

function scrollToFirstMatch(){
  // First rendered match item (after filtering)
  const first = document.querySelector("#app .item");
  if (!first) return;

  // Give the browser a tick after opening sections
  requestAnimationFrame(() => {
    first.scrollIntoView({ behavior: "smooth", block: "start" });
  });
}


      
      // FALLBACK: link
      return `
        <div class="item" data-search="${escapeHtml((item.title||"") + " " + (item.note||""))}">
          <div class="item-meta">
            <div class="item-title">${title}</div>
            <div class="item-note">${note}</div>
          </div>
          <a class="link" href="${escapeHtml(url)}" target="_blank" rel="noopener">Open link</a>
        </div>
      `;
    }



function applyCollapseLogic(hasSearch){
  // Always start collapsed so only category names show
  document.querySelectorAll("details.category, details.subcat").forEach(d => {
    d.removeAttribute("open");
  });

  // If searching, we'll re-open only the matching sections elsewhere
  // (handled by openMatchingSections()).
}


 function openMatchingSections(){
  document.querySelectorAll(".item").forEach(item => {
    // If item is visible, open its parent sections
    const detailsSub = item.closest("details.subcat");
    const detailsCat = item.closest("details.category");

    if (detailsSub) detailsSub.setAttribute("open", "");
    if (detailsCat) detailsCat.setAttribute("open", "");
  });
}
   
    
    function renderEmpty(){
      return `<div class="empty">No results</div>`;
    }

    function render(){
      const q = (searchInput.value || "").trim().toLowerCase();
      let totalShown = 0;
      let totalAll = 0;

      const html = PAGE_DATA.map(cat => {
        const totalCat = countItemsInCategory(cat);
        totalAll += totalCat;

        // With subcategories
        if (Array.isArray(cat.subcategories)) {
          const subHtml = cat.subcategories.map(sub => {
            const allItems = sub.items || [];
            const filtered = q ? allItems.filter(i => itemMatches(i, q)) : allItems;
            totalShown += filtered.length;

            return `
              <details class="subcat" open>
                <summary>
                  <span>${escapeHtml(sub.name)}</span>
                  <span class="count">${filtered.length}/${allItems.length}</span>
                </summary>
                <div class="items">
                  ${filtered.length ? filtered.map(renderItem).join("") : renderEmpty()}
                </div>
              </details>
            `;
          }).join("");

          return `
            <div class="card">
              <details class="category" open>
                <summary>
                  <div class="cat-title">${escapeHtml(cat.category)}</div>
                  <div class="count">${q ? "matches" : "total"}: ${q ? "" : ""}${totalCat}</div>
                </summary>
                <div class="content">
                  <div class="subgrid">
                    ${subHtml}
                  </div>
                </div>
              </details>
            </div>
          `;
        }

        // Flat category
        const allItems = cat.items || [];
        const filtered = q ? allItems.filter(i => itemMatches(i, q)) : allItems;
        totalShown += filtered.length;

        return `
          <div class="card">
            <details class="category" open>
              <summary>
                <div class="cat-title">${escapeHtml(cat.category)}</div>
                <div class="count">${filtered.length}/${allItems.length}</div>
              </summary>
              <div class="content">
                ${filtered.length ? filtered.map(renderItem).join("") : renderEmpty()}
              </div>
            </details>
          </div>
        `;
      }).join("");

      app.innerHTML = html;

    const hasSearch = q.length > 0;

applyCollapseLogic(hasSearch);

if (hasSearch) {
  openMatchingSections();
  scrollToFirstMatch();
}
        
      tmWirePlaylistRows();
      enableMobileTitleExpand();
      wireNoteRows();
      wireYouTubeRows();

      if (!q) {
        resultChip.textContent = `Showing all (${totalAll} item${totalAll === 1 ? "" : "s"})`;
      } else {
        resultChip.textContent = `Matches: ${totalShown}`;
      }
    }

function tmFmtTime(sec){
  if (!isFinite(sec) || sec < 0) return "0:00";
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60);
  return `${m}:${String(s).padStart(2,"0")}`;
}

function tmWirePlayers(){
  const players = document.querySelectorAll(".tm-player");

  players.forEach(p => {
    const audio = p.querySelector("audio");
    const btn = p.querySelector(".tm-btn");
    const seek = p.querySelector(".tm-seek");
    const time = p.querySelector(".tm-time");

    if (!audio || !btn || !seek || !time) return;

    const update = () => {
      const dur = audio.duration || 0;
      const cur = audio.currentTime || 0;

      time.textContent = `${tmFmtTime(cur)} / ${dur ? tmFmtTime(dur) : "0:00"}`;

      if (dur) {
        seek.value = Math.floor((cur / dur) * 1000);
      } else {
        seek.value = 0;
      }

      btn.textContent = audio.paused ? "‚ñ∂" : "‚è∏";
    };

    const pauseOthers = () => {
      document.querySelectorAll(".tm-player audio").forEach(a => {
        if (a !== audio) a.pause();
      });
    };

    btn.addEventListener("click", async () => {
      pauseOthers();
      if (audio.paused) {
        try { await audio.play(); } catch {}
      } else {
        audio.pause();
      }
      update();
    });

    seek.addEventListener("input", () => {
      const dur = audio.duration || 0;
      if (dur) audio.currentTime = (seek.value / 1000) * dur;
    });

    audio.addEventListener("loadedmetadata", update);
    audio.addEventListener("timeupdate", update);
    audio.addEventListener("play", update);
    audio.addEventListener("pause", update);
    audio.addEventListener("ended", update);

    update();
  });
}

function tmFmtTime(sec){
  if (!isFinite(sec) || sec < 0) return "0:00";
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60);
  return `${m}:${String(s).padStart(2,"0")}`;
}

function wireNoteRows(){
  document.querySelectorAll(".tm-note-row").forEach(row => {
    row.addEventListener("click", () => {
      const url = row.getAttribute("data-url");
      if (url) {
        window.open(url, "_blank", "noopener");
      }
    });
  });
}

function wireYouTubeRows(){
  document.querySelectorAll(".tm-link-row").forEach(row => {
    row.addEventListener("click", () => {
      const url = row.getAttribute("data-url");
      if (url) window.open(url, "_blank", "noopener");
    });
  });
}
    
function tmWirePlaylistRows(){
  const rows = document.querySelectorAll(".tm-row");

  rows.forEach(row => {
    const audio = row.querySelector("audio");
    const btn = row.querySelector(".tm-play");
    const durEl = row.querySelector(".tm-dur");
    const bar = row.querySelector(".tm-progress > div");
    const progressWrap = row.querySelector(".tm-progress");
    const speedBtn = row.querySelector(".tm-speed");

    if (!audio || !btn || !durEl || !bar) return;

    const pauseOthers = () => {
      document.querySelectorAll(".tm-row audio").forEach(a => {
        if (a !== audio) a.pause();
      });
    };

    const updateBtn = () => {
      btn.textContent = audio.paused ? "‚ñ∂" : "‚è∏";
    };

    const updateDur = () => {
      if (audio.duration) durEl.textContent = `(${tmFmtTime(audio.duration)})`;
    };

    const updateProgress = () => {
      if (!audio.duration) { bar.style.width = "0%"; return; }
      const pct = (audio.currentTime / audio.duration) * 100;
      bar.style.width = `${Math.max(0, Math.min(100, pct))}%`;
    };

    // Play button click
    btn.addEventListener("click", async (e) => {
      e.stopPropagation(); // don't also trigger row click
      pauseOthers();
      if (audio.paused) {
        try { await audio.play(); } catch {}
      } else {
        audio.pause();
      }
      updateBtn();
    });

    // Whole row click (toggle play/pause)
    row.addEventListener("click", async (e) => {
      // If they clicked the progress bar, let the progress handler handle it
      if (e.target.closest(".tm-progress")) return;

      pauseOthers();
      if (audio.paused) {
        try { await audio.play(); } catch {}
      } else {
        audio.pause();
      }
      updateBtn();
    });

    // Click-to-seek on the progress bar
    if (progressWrap) {
      progressWrap.addEventListener("click", (e) => {
        e.stopPropagation(); // prevent row toggle
        if (!audio.duration) return;

        const rect = progressWrap.getBoundingClientRect();
        const x = Math.max(0, Math.min(rect.width, e.clientX - rect.left));
        const pct = x / rect.width;
        audio.currentTime = pct * audio.duration;
      });
    }

    audio.addEventListener("loadedmetadata", () => {
      updateDur();
      updateProgress();
      updateBtn();
    });

    audio.addEventListener("timeupdate", updateProgress);
    audio.addEventListener("play", updateBtn);
    audio.addEventListener("pause", updateBtn);
    audio.addEventListener("ended", () => {
      updateBtn();
      bar.style.width = "0%";
    });
// Playback speed control
if (speedBtn) {
  const speeds = [1, 1.5, 2];
  let speedIndex = 0;

  speedBtn.addEventListener("click", (e) => {
    e.stopPropagation(); // don't toggle play/pause
    speedIndex = (speedIndex + 1) % speeds.length;
    const newSpeed = speeds[speedIndex];
    audio.playbackRate = newSpeed;
    speedBtn.textContent = `${newSpeed}√ó`;
  });

  audio.addEventListener("loadedmetadata", () => {
    audio.playbackRate = speeds[speedIndex];
    speedBtn.textContent = `${speeds[speedIndex]}√ó`;
  });
}

    // Initial state
    updateBtn();
  });
}



    
    searchInput.addEventListener("input", render);
    render();
  </script>
</body>
</html>
